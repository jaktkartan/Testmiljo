<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <title>Jakttider</title>
</head>
<body>
    <h1>Jakttider</h1>
    <label for="county">Välj län:</label>
    <select id="county">
        <option value="Blekinge län">Blekinge län</option>
        <option value="Dalarnas län">Dalarnas län</option>
        <option value="Gotlands län">Gotlands län</option>
        <option value="Gävleborgs län">Gävleborgs län</option>
        <option value="Hallands län">Hallands län</option>
        <option value="Jämtlands län">Jämtlands län</option>
        <option value="Jönköpings län">Jönköpings län</option>
        <option value="Kalmar län">Kalmar län</option>
        <option value="Kronobergs län">Kronobergs län</option>
        <option value="Norrbottens län">Norrbottens län</option>
        <option value="Skåne län">Skåne län</option>
        <option value="Stockholms län">Stockholms län</option>
        <option value="Södermanlands län">Södermanlands län</option>
        <option value="Uppsala län">Uppsala län</option>
        <option value="Värmlands län">Värmlands län</option>
        <option value="Västerbottens län">Västerbottens län</option>
        <option value="Västernorrlands län">Västernorrlands län</option>
        <option value="Västmanlands län">Västmanlands län</option>
        <option value="Västra Götalands län">Västra Götalands län</option>
        <option value="Örebro län">Örebro län</option>
        <option value="Östergötlands län">Östergötlands län</option>
    </select>
    <br>
    <label for="date">Välj datum:</label>
    <input type="date" id="date" name="date">
    <br>
    <button onclick="getHuntingInfo()">Sök</button>
    <div id="results"></div>

    <script>
        async function fetchHuntingData() {
            const response = await fetch('bottom_panel/Jaktbart_idag/cleaned_jakttider.json');
            const data = await response.json();
            return data;
        }

        function parseDateWithoutYear(dateString) {
            const [day, month] = dateString.split(' ');
            const months = {
                'Januari': '01',
                'Februari': '02',
                'Mars': '03',
                'April': '04',
                'Maj': '05',
                'Juni': '06',
                'Juli': '07',
                'Augusti': '08',
                'September': '09',
                'Oktober': '10',
                'November': '11',
                'December': '12'
            };
            return `${months[month]}-${day.padStart(2, '0')}`;
        }

        function isWithinDateRange(startDate, endDate, checkDate) {
            const start = parseDateWithoutYear(startDate);
            const end = parseDateWithoutYear(endDate);
            const check = checkDate.slice(5);  // Remove the year part

            if (start <= end) {
                return start <= check && check <= end;
            } else {
                // If the date range spans the end of the year (e.g., December to January)
                return start <= check || check <= end;
            }
        }

        function formatResult(result) {
            const monthNames = {
                '01': 'Januari',
                '02': 'Februari',
                '03': 'Mars',
                '04': 'April',
                '05': 'Maj',
                '06': 'Juni',
                '07': 'Juli',
                '08': 'Augusti',
                '09': 'September',
                '10': 'Oktober',
                '11': 'November',
                '12': 'December'
            };

            function formatDate(dateString) {
                const [day, month] = dateString.split(' ');
                const months = {
                    'January': 'Januari',
                    'February': 'Februari',
                    'March': 'Mars',
                    'April': 'April',
                    'May': 'Maj',
                    'June': 'Juni',
                    'July': 'Juli',
                    'August': 'Augusti',
                    'September': 'September',
                    'October': 'Oktober',
                    'November': 'November',
                    'December': 'December'
                };
                return `${day} ${months[month]}`;
            }

            return `
                <div>
                    <h3>${result['Slag av vilt']}</h3>
                    <p><strong>Starttid:</strong> ${formatDate(result['Starttid'])}</p>
                    <p><strong>Sluttid:</strong> ${formatDate(result['Sluttid'])}</p>
                    ${result['Upplysning'] ? `<p><strong>Upplysning:</strong> ${result['Upplysning']}</p>` : ''}
                </div>
            `;
        }

        async function getHuntingInfo() {
            const county = document.getElementById('county').value.trim();
            const date = document.getElementById('date').value;

            if (!county || !date) {
                alert("Vänligen fyll i både län och datum.");
                return;
            }

            const data = await fetchHuntingData();

            const results = data.filter(entry => {
                const areas = entry['Område'].split(',');
                return areas.some(area => area.trim() === county) &&
                       isWithinDateRange(entry['Starttid'], entry['Sluttid'], date);
            });

            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = results.length > 0 ? results.map(formatResult).join('') : "Inga resultat funna.";
        }
    </script>
</body>
</html>
